<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Driving Direction Game</title>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    
        <!-- Favicon for the tab bar -->
        <link rel="icon" type="image/png" href="images/favicon.png"> <!-- PNG Favicon -->
        <!-- If using .ico -->
        <!-- <link rel="icon" type="image/x-icon" href="images/favicon.ico"> -->
    
        <!-- Other head content like stylesheets, etc. -->
        <head>
            <meta name="apple-mobile-web-app-capable" content="yes">
            <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
            <link rel="apple-touch-icon" sizes="180x180" href="images/apple-icon.png">
            <title>Direction Game</title>
            <!-- Other meta tags -->
        </head>
        
    </head>
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driving Direction Game</title>
    <style>
        :root {
            --title-color: #4CAF50; /* Title color */
            --button-bg-color: #4CAF50; /* Button background color */
            --button-hover-color: #45a049; /* Button hover color */
            --text-color: #333; /* Light mode text color */
            --text-dark-color: #f2f2f2; /* Dark mode text color */
            --bg-light: linear-gradient(135deg, #f2f2f2, #d0e6f7); /* Light mode background gradient */
            --bg-dark: linear-gradient(135deg, #333, #111); /* Dark mode background gradient */
        }

        /* Basic Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background: var(--bg-light);
            color: var(--text-color);
            transition: background 0.5s, color 0.5s; /* Smooth transition for dark mode */
        }

        .dark-mode {
            background: var(--bg-dark);
            color: var(--text-dark-color);
            transition: background 0.5s, color 0.5s
        }

        /* Title Styling */
        .title {
            font-size: 40px;
            font-family: 'Permanent Marker', cursive;
            font-weight: 400; /* Existing font weight */
            margin: 20px 0; /* Existing margin */
            color: var(--button-bg-color); /* Match title color with button color */
            text-align: center; /* Center align the text */
}

/* Responsive adjustments */
@media (max-width: 600px) { /* Adjust for mobile screens */
    .title {
        font-size: 34px; /* Smaller size for mobile */
        margin: 10px 0; /* Adjust margin for better spacing */
    }
}

        /* Splash Screen Styling */
        .splash-screen {
    position: fixed;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.9);
    color: white;
    font-size: 24px;
    line-height: 1.5;
    padding: 0px; /* Add padding around the entire splash screen */
    border-radius: 0px; /* Optional: rounded corners */
    text-align: center; /* Center align the text */
    display: flex; /* Use flexbox for centering content */
    flex-direction: column; /* Arrange items vertically */
    justify-content: center; /* Center items vertically */
    align-items: center; /* Center items horizontally */
    z-index: 1000; /* Ensure it appears above other content */
}

.welcome-message {
    font-size: 32px; /* Set a larger font size for the welcome message */
    margin-bottom: 20px; /* Space below the welcome message */
}

.instructions {
    margin-bottom: 15px; /* Space below the instructions title */
    font-weight: bold; /* Make instructions title bold */
}

.instruction-item {
    margin-bottom: 10px; /* Space between each instruction */
}

.click-to-start {
    margin-top: 20px; /* Space above the "Click to start" text */
}





        




        /* Button Styles */
        .button {
            padding: 10px;
            font-size: 18px;
            background-color: var(--button-bg-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            min-width: 120px;
            height: 50px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }


        /* Remove hover effect */
        .button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.25);
        }

        /* Start Again and Settings Button positioning */
        .side-buttons {
            position: absolute;
            top: 90px; /* Adjusted to lower buttons further down */
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .start-again-button {
            position: absolute;
            top: 90px; /* Adjusted to align with settings button */
            left: 20px;
            right: auto; /* Reset right positioning */
        }

        .settings-button {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }

        /* Directions and Log */
        .current-direction, .log {
            margin-top: 78px; /* Increased margin for more space */
            width: 90%;
            text-align: center;
            font-size: 20px;
            transition: opacity 0.5s;
        }

        .button-container {
  display: flex; /* Use flexbox for horizontal layout */
  gap: 30px; /* Adjust the gap between buttons as needed */
}

        .current-direction {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px; /* Increase this value to create more space */
        }

        .stats {
            margin-top: 10px;
            font-size: 18px;
        }

        /* Flex Layouts */
        .roundabouts {
            margin-top: 20px;
            text-align: center;
        }

        .roundabout-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }

        :root {
    /* Other existing variables */
    --modal-bg-light: #fff; /* Light mode background for modal */
    --modal-bg-dark: #2c2c2c; /* Dark mode background for modal */
    --modal-text-light: #000; /* Light mode text color */
    --modal-text-dark: #f2f2f2; /* Dark mode text color */
}

/* Modal Styling */
.modal-content {
    background-color: var(--modal-bg-light); /* Default to light mode */
    color: var(--modal-text-light); /* Default text color */
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    width: 300px;
    text-align: left;
}

/* Dark mode adjustments for modal */
.dark-mode .modal-content {
    background-color: var(--modal-bg-dark); /* Change background for dark mode */
    color: var(--modal-text-dark); /* Change text color for dark mode */
}
;


        .close {
            float: right;
            font-size: 28px;
            cursor: pointer;
        }

        /* Input and Labels */
        label {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .no-animation .button {
            transition: none;
        }

        /* Button click feedback */
        .button:active {
         transform: scale(0.95); /* Button shrinks slightly when clicked */
         background-color: var(--button-hover-color); /* Slightly change background color */
        }

        /* Splash screen fade-out */
        .splash-screen.fade-out {
        opacity: 0;
        transform: scale(0.9);
        transition: opacity 0.5s ease, transform 0.5s ease;

        .log-entry {
        opacity: 0;
        transform: translateY(-10px);
        transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .log-entry.visible {
        opacity: 1;
        transform: translateY(0);
        }

        .welcome-message {
        margin-bottom: 20px; /* Adjust this value for desired spacing */
        }





}





        
    </style>
</head>
<body>

    

    <div class="splash-screen" id="splashScreen">
        <div class="welcome-message">Welcome to the Driving Direction Game!</div>
        <div class="instructions"><strong>Instructions:</strong></div>
        <div class="instruction-item">1. Click "Next Direction" to receive your driving instruction.</div>
        <div class="instruction-item">2. If you only need to turn, click "Left or Right.".</div>
        <div class="instruction-item">3. Follow the on-screen directions precisely.</div>
        <div class="instruction-item">4. Use the buttons to navigate through roundabouts.</div>
        <div class="instruction-item">5. Navigate roundabouts using the provided buttons.</div>
        <div class="click-to-start">Click to start playing!</div>
    </div> <!-- Splash Screen -->
    

    
    

    <div class="title">Driving Direction Game</div>
    <div id="stats" class="stats" aria-live="polite">Left: 0 | Right: 0 | Straight: 0 | Roundabouts: 0</div>

    <!-- Side Buttons for Start Again and Settings -->
    <button id="startAgainButton" class="button start-again-button" aria-label="Start Again">Start Again</button>
    <div class="side-buttons">
        <button id="settingsButton" class="settings-button" aria-label="Open Settings">⚙️</button>
    </div>

    <div class="current-direction" id="currentDirection" aria-live="polite">Start Your Engine!</div>


    <div class="button-container">
        <button id="directionButton" class="button" aria-label="Get Direction">Next Direction</button>
        <button id="leftOrRightBtn" class="button" aria-label="Left Or Right">Left Or Right</button>
      </div>


    <div class="roundabouts">
        <h3>Roundabouts</h3>
        <div class="roundabout-buttons">
            <button id="roundabout2" class="button" aria-label="Roundabout with 2 exits">2 Exits</button>
            <button id="roundabout3" class="button" aria-label="Roundabout with 3 exits">3 Exits</button>
            <button id="roundabout4" class="button" aria-label="Roundabout with 4 exits">4 Exits</button>
            <button id="roundabout5" class="button" aria-label="Roundabout with 5 exits">5 Exits</button>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">&times;</span>
            <h2>Settings</h2>
            <label>
                <input type="checkbox" id="toggleSound" checked> Engine Sound
            </label>
            <label>
                <input type="checkbox" id="toggleBeep"> Beep Beep
            </label>
            <label>
                <input type="checkbox" id="toggleGPSVoice" checked> GPS Voice
            </label>
            <label>
                <input type="color" id="buttonColorPicker"> Button Color
            </label>
            <label>
                <input type="checkbox" id="toggleDarkMode"> Dark Mode
            </label>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="startSound" src="sounds/engine-start.mp3"></audio>
    <audio id="beepSound" src="sounds/beep.mp3"></audio>
    <audio id="gpsLeft" src="sounds/gps-left.mp3"></audio>
    <audio id="gpsRight" src="sounds/gps-right.mp3"></audio>
    <audio id="gpsStraight" src="sounds/gps-straight.mp3"></audio>
    <audio id="gpsExit1" src="sounds/gps-exit-1.mp3"></audio>
    <audio id="gpsExit2" src="sounds/gps-exit-2.mp3"></audio>
    <audio id="gpsExit3" src="sounds/gps-exit-3.mp3"></audio>
    <audio id="gpsExit4" src="sounds/gps-exit-4.mp3"></audio>
    <audio id="gpsExit5" src="sounds/gps-exit-5.mp3"></audio>

    <div class="log" id="log"></div> <!-- Log -->

    <script>
        function debounce(func, delay) {
    let timeoutId;
    return function(...args) {
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        timeoutId = setTimeout(() => {
            func.apply(this, args);
        }, delay);
    };
}

        const directions = ['Left', 'Right', 'Straight'];
        let log = []; // Stores direction history
        let soundsEnabled = true;
        let gpsVoiceEnabled = true;
        let beepEnabled = false;
        let darkModeEnabled = false;

        const currentDirectionElement = document.getElementById('currentDirection');
        const logElement = document.getElementById('log');
        const statsElement = document.getElementById('stats');
        const splashScreen = document.getElementById('splashScreen');

        let stats = { Left: 0, Right: 0, Straight: 0, Roundabout: 0 };

        function updateStatsDisplay() {
            statsElement.textContent = `Left: ${stats.Left} | Right: ${stats.Right} | Straight: ${stats.Straight} | Roundabouts: ${stats.Roundabout}`;
        }

        function incrementStats(key) {
            if (stats[key] !== undefined) {
                stats[key]++;
                updateStatsDisplay();
            }
        }

        updateStatsDisplay();

        /* Splash Screen Click */
        splashScreen.addEventListener('click', function () {
    this.style.opacity = 0; // Fade out effect
    setTimeout(() => this.style.display = 'none', 500); // Hide after fade-out
    if (soundsEnabled) playSound('startSound'); // Play sound if enabled
});


        /* Show a direction with sound and GPS voice */
        let lastDirection = ""; // To store the last shown direction
let lastDirectionCount = 0; // Count of consecutive same directions
let lastLeftOrRight = ""; // To store the last left/right direction
let lastLeftOrRightCount = 0; // Count of consecutive left/right same directions

// Sample directions for the 'Get Direction' button

// Add event listener for "Get Direction" button
document.getElementById('directionButton').addEventListener('click', () => {
    const direction = directions[Math.floor(Math.random() * directions.length)];
});

// Add event listener for "Left or Right" button
document.getElementById('leftOrRightBtn').addEventListener('click', () => {
    showLeftOrRightDirection();
});

let straightCount = 0;
let timeoutId;

async function showDirection(direction) {
    let directionText;

    if (direction === "Straight") {
  straightCount++;
} else {
  straightCount = 0; // Reset counter if direction changes
}

// Check if a timeout is already set
if (timeoutId) {
  clearTimeout(timeoutId);
}

// Set a new timeout if going straight for a long time
if (straightCount >= 1) { // Adjust the threshold as needed
  timeoutId = setTimeout(() => {
    showStraightPrompt();
  }, 60000); // 60 seconds
}

    if (direction === 'Straight') {
        directionText = `Go ${direction}`;
    } else {
        directionText = `Turn ${direction}`;
    }

    // Check if the current direction is the same as the last one
    if (direction === lastDirection) {
        lastDirectionCount++;
    } else {
        lastDirection = direction; // Update last direction
        lastDirectionCount = 1; // Reset count
    }

    // If the direction has been shown twice already, choose a new one
    if (lastDirectionCount > 2) {
        // Get a different direction
        let newDirection;
        do {
            newDirection = directions[Math.floor(Math.random() * directions.length)];
        } while (newDirection === lastDirection); // Keep choosing until it's different

        showDirection(newDirection); // Recursively show the new direction
        return; // Exit this function
    }

    function showStraightPrompt() {
  // Display the prompt (e.g., using a modal or alert)
  alert("You've been going straight for a while. Consider changing direction.");

  // Reset the straight count
  straightCount = 0;
}
    currentDirectionElement.textContent = directionText;
    addDirectionToLog(directionText);
    incrementStats(direction);

      // Await for the UI update before playing audio
    await new Promise(resolve => requestAnimationFrame(resolve));

    
    
    // Add 'active' class for visual feedback
    currentDirectionElement.classList.add('active');
    setTimeout(() => currentDirectionElement.classList.remove('active'), 500); // Remove after 500ms

    setTimeout(() => {
    playDirectionSound(direction);
    playBeepSound();
  }, 200); // Adjust the delay as needed
}

async function showLeftOrRightDirection() {
    const leftOrRight = Math.random() < 0.5 ? 'Left' : 'Right';
    let directionText = `Turn ${leftOrRight}`;

    // Check if the current left/right direction is the same as the last one
    if (leftOrRight === lastLeftOrRight) {
        lastLeftOrRightCount++;
    } else {
        lastLeftOrRight = leftOrRight; // Update last left/right direction
        lastLeftOrRightCount = 1; // Reset count
    }

    // If the left/right direction has been shown twice already, choose a new one
    if (lastLeftOrRightCount > 2) {
        // Get a different direction
        let newDirection;
        do {
            newDirection = Math.random() < 0.5 ? 'Left' : 'Right';
        } while (newDirection === lastLeftOrRight); // Keep choosing until it's different

        directionText = `Turn ${newDirection}`; // Update to the new direction
        lastLeftOrRight = newDirection; // Update last left/right
    }

    currentDirectionElement.textContent = directionText;
    addDirectionToLog(directionText);
    incrementStats(leftOrRight);
      // Await for the UI update before playing audio
  await new Promise(resolve => requestAnimationFrame(resolve));
    
    // Add 'active' class for visual feedback
    currentDirectionElement.classList.add('active');
    setTimeout(() => currentDirectionElement.classList.remove('active'), 500); // Remove after 500ms

    setTimeout(() => {
    playDirectionSound(leftOrRight);
    playBeepSound();
  }, 200); // Adjust the delay as needed
}








function savePreferences() {
    const preferences = {
        soundsEnabled,
        gpsVoiceEnabled,
        beepEnabled,
        darkModeEnabled,
        buttonColor: document.documentElement.style.getPropertyValue('--button-bg-color') // Save current button color
    };
    localStorage.setItem('preferences', JSON.stringify(preferences));
}


function loadPreferences() {
    const preferences = JSON.parse(localStorage.getItem('preferences'));
    if (preferences) {
        soundsEnabled = preferences.soundsEnabled;
        gpsVoiceEnabled = preferences.gpsVoiceEnabled;
        beepEnabled = preferences.beepEnabled;
        toggleDarkMode(preferences.darkModeEnabled);

        // Restore button color
        if (preferences.buttonColor) {
            document.documentElement.style.setProperty('--button-bg-color', preferences.buttonColor);
            document.documentElement.style.setProperty('--button-hover-color', preferences.buttonColor);
            document.getElementById('buttonColorPicker').value = preferences.buttonColor; // Set the color picker value
        }

        // Set the initial state of checkboxes based on preferences
        document.getElementById('toggleSound').checked = soundsEnabled;
        document.getElementById('toggleGPSVoice').checked = gpsVoiceEnabled;
        document.getElementById('toggleBeep').checked = beepEnabled;
        document.getElementById('toggleDarkMode').checked = darkModeEnabled; 
    }
}


document.getElementById('toggleSound').addEventListener('change', function (e) {
    soundsEnabled = e.target.checked;
    savePreferences(); // Save preference change
});

document.getElementById('toggleBeep').addEventListener('change', function (e) {
    beepEnabled = e.target.checked;
    savePreferences(); // Save preference change
});

document.getElementById('toggleGPSVoice').addEventListener('change', function (e) {
    gpsVoiceEnabled = e.target.checked;
    savePreferences(); // Save preference change
});

document.getElementById('toggleDarkMode').addEventListener('change', function (e) {
    toggleDarkMode(e.target.checked);
    savePreferences(); // Save preference change
});



window.addEventListener('load', loadPreferences);
window.addEventListener('beforeunload', savePreferences);


function addDirectionToLog(direction) {
    const newLogEntry = document.createElement('div');
    newLogEntry.classList.add('log-entry'); // Apply log-entry class
    newLogEntry.textContent = direction;
    
    // Prepend new entry to log and apply visible class for fade-in
    logElement.prepend(newLogEntry);
    setTimeout(() => newLogEntry.classList.add('visible'), 10); // Trigger fade-in after a slight delay
}


        /* Play sound based on direction */
        function playDirectionSound(direction) {
            if (gpsVoiceEnabled) {
                const soundId = {
                    'Left': 'gpsLeft',
                    'Right': 'gpsRight',
                    'Straight': 'gpsStraight'
                }[direction];
                const sound = document.getElementById(soundId);
                if (sound) sound.play();
            }
        }

        /* Play beep sound if enabled */
        function playBeepSound() {
            if (beepEnabled) {
                playSound('beepSound');
            }
        }

        /* Add direction to log (prepend) */
        function addDirectionToLog(direction) {
            log.unshift(direction); // Add new direction to the start of the log array
            logElement.innerHTML = log.join('<br/>'); // Update the log display
        }

        /* Roundabout function */
        function handleRoundabout(exits) {
            const exitNumber = Math.floor(Math.random() * exits) + 1; // Random exit number
            const exitDirection = `Take the ${exitNumber}${getOrdinal(exitNumber)} exit`;
            currentDirectionElement.textContent = exitDirection;
            addDirectionToLog(exitDirection);
            incrementStats('Roundabout');
            playRoundaboutGPS(exitNumber);
            playBeepSound(); // Play beep sound if enabled
        }

        /* Play roundabout GPS voice */
        function playRoundaboutGPS(exit) {
            if (gpsVoiceEnabled) {
                const sound = document.getElementById(`gpsExit${exit}`);
                if (sound) sound.play();
            }
        }

        /* Get ordinal suffix for exit */
        function getOrdinal(n) {
            return ["th", "st", "nd", "rd"][n % 10] || "th";
        }

        /* Event listeners for roundabouts */
        document.getElementById('roundabout2').addEventListener('click', debounce(() => handleRoundabout(2), 600));
        document.getElementById('roundabout3').addEventListener('click', debounce(() => handleRoundabout(3), 600));
        document.getElementById('roundabout4').addEventListener('click', debounce(() => handleRoundabout(4), 600));
        document.getElementById('roundabout5').addEventListener('click', debounce(() => handleRoundabout(5), 600));
        


        /* Get Direction Button Event */
        document.getElementById('directionButton').addEventListener('click', debounce(function () {
    const randomDirection = directions[Math.floor(Math.random() * directions.length)];
    showDirection(randomDirection);
    playBeepSound(); // Play beep sound when direction is fetched
}, 500)); // Adjust the delay as needed


        /* Settings Modal */
        const settingsModal = document.getElementById('settingsModal');
        document.getElementById('settingsButton').addEventListener('click', () => settingsModal.style.display = 'flex');
        document.getElementById('closeModal').addEventListener('click', () => settingsModal.style.display = 'none');

        /* Settings Change Handlers */
        document.getElementById('toggleSound').addEventListener('change', e => soundsEnabled = e.target.checked);
        document.getElementById('toggleBeep').addEventListener('change', e => beepEnabled = e.target.checked);
        document.getElementById('toggleGPSVoice').addEventListener('change', e => gpsVoiceEnabled = e.target.checked);
        document.getElementById('toggleDarkMode').addEventListener('change', e => toggleDarkMode(e.target.checked));
        document.getElementById('buttonColorPicker').addEventListener('input', e => {
        document.documentElement.style.setProperty('--button-bg-color', e.target.value);
        document.documentElement.style.setProperty('--button-hover-color', e.target.value); // Keep hover color the same
        });

        /* Toggle Dark Mode */
        function toggleDarkMode(enabled) {
            darkModeEnabled = enabled;
            document.body.classList.toggle('dark-mode', enabled);
        }

        /* Restart Game */
        document.getElementById('startAgainButton').addEventListener('click', function () {
    const confirmRestart = confirm("Are you sure you want to restart the game?");
    if (confirmRestart) {
        log = [];
        logElement.innerHTML = '';
        currentDirectionElement.textContent = 'Start Your Engine!';
        stats = { Left: 0, Right: 0, Straight: 0, Roundabout: 0 };
        updateStatsDisplay();
        if (soundsEnabled) playSound('startSound');
    }
});



        /* Play any sound */
        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            if (sound) sound.play();
        }
    </script>
</body>
</html>
